# 演算子
PHPの演算子には、単項演算子、二項演算子、三項演算子の３つが存在する。
## 単項演算子
一つの式に対して行われる演算
否定(!)

## 二項演算子
二つの式(オペランド)に対して行われる演算

### 代入演算子

```php
<?php
$a = 10;
```

### 代数演算子
代数演算子は５つ存在する。
代数演算は、数値値型（正数型、浮動小数点数型）に対して行われる。

|  演算子  |  意味  |
| ---- | ---- |
|  +   | 加算  |
|  -   | 減算  |
|  *   | 積　  |
|  /   | 商　  |
|  %   | 剰余  |

※数値でない方に対して演算を行った場合、数値にキャストされる

### ビット演算子
ビット演算子を用いるとビット演算を行うことができます。

|  演算子  |  意味  |
| ---- | ---- |
|  &   | ビット積  |
|  \|   | ビット和  |
|  ^   | 排他的論理和　  |
|  ~   | ビットの反転　  |
|  <<   | 左シフト  |
|  >>   | 右シフト  |

```php
printf("%032b\n", 15); // 00000000000000000000000000001111
// 数値の左側を0埋め、32桁表示、与えられた整数値をバイナリ値として表現される。
printf("%032b\n", 51); // 00000000000000000000000000110011
printf("%032b\n", 15 & 51); // 00000000000000000000000000000011
printf("%032b\n", 15 | 51); // 00000000000000000000000000111111
printf("%032b\n", 15 ^ 51); // 00000000000000000000000000111100
printf("%032b\n", ~15); // 1111111111111111111111111111111111111111111111111111111111110000
// 桁数が32を超えてしまっているが、64ビットシステムでビットの否定をすると64桁で表現されてしまうので64桁で表現されてしまうのかもしれない、、、
printf("%032b\n", 15 << 1); // 00000000000000000000000000011110
printf("%032b\n", 15 >> 1); // 00000000000000000000000000000111

```
https://www.php.net/manual/ja/function.printf.php

ビット演算の実用的な使い方は、オプションなどをフラグを用いて設定する場合。

```php
<?php
error_reporting(E_ALL | E_RESTRIICT);
```

### 文字列演算子
`.`ドットで文字列を連結する。
文字列ではない型の変数をドット演算子を用いて文字列に結合しようとすると、文字列への自動キャストが行われる。
整数を直接文字列として結合したい場合は、スペースを入れないと小数点と解釈されて浮動小数点数型となってしまう。

### 複合演算子
代数演算子、文字列演算子、ビット演算子、代入演算子と合わせて使用することができる。
これを複合演算子という。

左辺 演算子= 右辺

```php
$a = 10;
$b += 1;

echo $b; // 11
```

左辺と右辺を演算にかけ、結果を左辺に代入します。

### 加算子・減算子
加算子(++)・減算子(--)
前置と後置があり、前置するとまず演算をし、その結果が返される。
後置すると値を返した後に演算を行う。

```php
<?php
$a = 10;

echo $a++; // 10
echo $a; // 11
echo ++$a; // 12
echo $a; // 12
```

### 論理演算子

|  演算子  |  意味  |
| ---- | ---- |
|  && および and   | 論理積  |
|  \|\| および or   | 論理和  |
|  xor   | 排他的論理和　  |
|  !   | 否定　  |

論理積と論理和では、２種類の表記方法がある。
これらは演算子の優先順位が違う。

### 比較演算子

|  演算子  |  意味  |
| ---- | ---- |
|  ==   | 右辺と左辺が等しい場合にはtrue。右辺と左辺で型が違う場合はキャストされる。  |
|  != または <>   | 右辺と左辺が等しくない場合にはtrue。右辺と左辺で型が違う場合はキャストされる。  |
|  ===   | 右辺と左辺が等しい場合にはtrue。キャストが行われない（厳密な比較）　  |
|  !==   | 右辺と左辺が等しくない場合にはtrue。キャストが行われない（厳密な比較）　  |
|  <  |  右辺より左辺が小さい場合にtrue。  |
| > | 右辺より左辺が大きい場合にtrue。 |
|  <=   | 右辺より左辺が小さいか等しい場合にtrue。  |
|  >=   | 右辺より左辺が大きいか等しい場合にtrue。  |

自動キャストが行われると、プログラムが期待しない結果を導き出す場合がある。
自動キャストを防ぐ為に、基本的に厳密な比較を行うことを推奨します。

### 型演算子
型演算子(instanceof)は、右辺が特定のクラスのインスタンスの場合にtrueを返す。

```php
<?php

class A
{
}

$a = new A();

if ($a instanceof A) {
    echo '$a は Aのインスタンスです'； // 出力される
}
```
型演算子では、特定のクラスのインスタンスかどうかだけではなく、
- 特定のクラスを継承したクラスのインスタンスか
- 特定のインターフェースを実装したクラスのインスタンスか
も調べることができる。

## 三項演算子
条件演算子とも呼ばれる。

条件式 ? 式1 : 式2

三項演算子は条件式を評価し、真ならば式1を、偽ならば式2を評価します。
演算子の返り値は、式1、式2のどちらかの評価順となります。

### 三項演算子の省略記法(PHP 5.3以上)

条件式 ?: 式1

このような表記をした場合、条件式が真の場合には条件式の評価値を、偽の場合には式1の評価値を返す。

```php
<?php

function some_func() {
    // 省略(データ取得ロジックなど)
}

// これだと some_func() が2回呼び出されてしまう。
$result = some_func() ? some_func() : 'default';

// 一回代入すれば呼び出しは一回で済む。
$funcResult = some_func();
$result = $funcResult ? $funcResult : 'default';

// 省略記法だとこうなる
$result = some_func() ?: 'default';
```

あらかじめ代入しておくか、省略記法を使用するかはその時々で判断すると良さそう。

### 三項演算子の結合規則
PHPの三項演算子の結合規則は左結合になっています。
※php以外のほとんどのプログラミング言語では三項演算子は右結合らしいです。

```php
<?php

$t = true;
$f = false;

echo $t ? 1 : $f ? 2 : 0; // 2
```
出力は2となっていますが、PHP7.4からは`Deprecated`となっており、
PHP8.0からは、`Fatal error`となります。

上記エラーは、カッコで囲むことで回避することができます。

```php
<?php

<?php

$t = true;
$f = false;

echo ($t ? 1 : $f) ? 2 : 0;
```
まずはカッコ内の三項演算子が評価され、その次に評価された結果が条件式となる三項演算子が評価されます。

PHP8.0以上ではエラーが出るので問題ないと思いますが、カッコなしの三項演算子のネストは可読性を損なうと思うので、特段理由がなければ複数行で記述するのが良さそうです。

### 演算子の優先順位
各演算子には優先順位が決まっており、優先順位の高い演算子を用いた演算から評価されます。
演算子がたくさん並ぶような処理を読む時は、[演算子の優先順位](https://www.php.net/manual/ja/language.operators.precedence.php)を参考にすると良さそうです。
厳密には不要な場所でも、括弧をつけておくことでコードの可読性が上がることもあるので、先に演算をしたい部分がある場合は括弧を付けるようにしましょう。

## その他演算子
### エラー制御演算子
エラー制御子(@)は、その式で発生するエラーを抑制する。

### 実行演算子
実行演算子(`)は、外部のシェルコマンドを実行するための演算子です。
実行演算子によるシェルコマンドの実行は、shell_exec()関数を用いる事と等価。

※phpスクリプトから外部のコマンドを実行する際は、セキュリティに十分注意する。
外部からの入力値をそのまま外部コマンドの実行に用いたりすると恐ろしいことが起きる可能性があります。